
**MVP → 本番デプロイ完了までの完全フェーズフロー**
※ 各フェーズ **最大3ステップ厳守**
※ **Vercel（UI）＋ Railway（API / DB）前提**
※ Agent / 人間どちらが見てもブレない構成

---

# 本番デプロイ完了までの Phase Flow（確定版）

---

## Phase 6：本番前最終仕様固定（Freeze Phase）

**目的**
「これ以上変えない」範囲を明確にし、実装ブレを止める。

### Step 6-1：仕様フリーズ宣言

* 対象：

  * トレードノート生成フロー
  * 判断モード推定（順張り / 逆張り）
  * 時間足選択（最大3）
  * エラーハンドリング & 通知ルール
* **新機能追加・仕様変更を禁止**

### Step 6-2：本番用非機能要件の確定

* 環境変数一覧（Railway / Vercel）
* 日次ジョブ実行時刻
* ログ保持方針（最低限）

### Step 6-3：本番データ破壊禁止ルール定義

* migrate reset 禁止
* seed 実行禁止
* 本番 DB は **append-only**

✅ Exit：
「この仕様で世に出す」と言える状態

---

## Phase 7：本番インフラ構築（Deploy Infra）

**目的**
コードを置く「器」を先に完成させる。

### Step 7-1：Railway（API / DB）構築

* PostgreSQL 作成
* API サービス作成
* 環境変数設定

  * `DB_URL`
  * `NODE_ENV=production`
  * `CRON_ENABLED=true`

### Step 7-2：Vercel（UI）構築

* GitHub リポジトリ連携
* 環境変数設定

  * `NEXT_PUBLIC_API_BASE_URL`
* Preview / Production 環境分離

### Step 7-3：疎通確認（空でもOK）

* UI → API `/health`
* API → DB 接続確認
* **データはまだ不要**

✅ Exit：
「空の本番環境が生きている」

---

## Phase 8：本番向け API デプロイ & 検証

**目的**
API + DB を本番品質で成立させる。

### Step 8-1：API 本番デプロイ

* Railway に push
* Prisma migrate deploy 実行
* テーブル生成確認

### Step 8-2：本番向け初期データ投入

* インジケーター定義（RSI / SMA / BB / MACD）
* マスターデータのみ投入
* **トレードデータは入れない**

### Step 8-3：API 単体動作確認

* `/notifications`（空配列）
* `/daily-status`（未実行）
* エラー時ログ確認

✅ Exit：
「API は一人で立っている」

---

## Phase 9：UI 本番デプロイ & 結合確認

**目的**
ユーザー視点で“使える形”にする。

### Step 9-1：UI 本番デプロイ

* Vercel Production Deploy
* API Base URL 切替
* ビルドエラーゼロ確認

### Step 9-2：UI → API 結合確認

* 通知一覧表示（0件）
* エラーバナー表示テスト
* 設定画面遷移確認

### Step 9-3：UX 破綻チェック

* 何もない状態で違和感がないか
* 通知がうるさくないか
* 空状態の文言チェック

✅ Exit：
「触って嫌じゃない」

---

## Phase 10：本番データ流入テスト（限定）

**目的**
“本当にノートができるか”を確認。

### Step 10-1：本番用 CSV インポート（手動）

* 1日分のみ
* CLI / 管理画面経由
* ログを詳細確認

### Step 10-2：日次ジョブ手動実行

* ノート下書き生成
* DailyImportStatus 記録
* エラー通知挙動確認

### Step 10-3：UI で承認フロー確認

* ノート表示
* AI 推定表示
* 承認 / 修正

✅ Exit：
「このアプリ、ちゃんと意味がある」

---

## Phase 11：本番リリース宣言（Soft Launch）

**目的**
“使い始められる状態”にする。

### Step 11-1：自動日次処理 ON

* Railway Cron 有効化
* 失敗通知テスト

### Step 11-2：運用ルール確定

* 障害時の対応
* ロールバック基準
* DB バックアップ頻度

### Step 11-3：リリース宣言

* 「知り合いに使ってもらえる」
* 機能追加は次フェーズへ

✅ Exit：
**本番デプロイ完了**

---

## このフローの強み（設計評価）

* 各 Phase のゴールが明確
* 最大3ステップで迷わない
* 途中で仕様に戻らない
* 「作る → 壊れる → 直す」が起きにくい

---

