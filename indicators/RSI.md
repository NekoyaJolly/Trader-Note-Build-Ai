# RSI 定義書（Relative Strength Index）

本定義は TradeAssist における RSI の公式ドキュメントであり、雛形と同一構造で記述する。数値と語彙を三層で分離し、マッチング・ノート生成・通知で一貫して利用する。

## メタ情報（管理用）
- indicator_id: `rsi`
- カテゴリ: momentum（モメンタム系）
- 定義バージョン: 1.0.0
- 導入日: 2025-12-27

## 1. インジケーター概要
- 価格の上昇幅と下落幅の相対強度を 0〜100 のスケールで示すモメンタム系オシレーター
- 標準期間は 14。本プロジェクトでは終値ベースで算出し、期間変更はユーザー設定として許可する

## 2. 想定トレーダーペルソナ
- 短期の逆張り転換を狙う裁量トレーダー（経験 1〜3 年、リスク許容度: 中）
- 日中は相場を随時モニタリングし、明確なシグナル時のみエントリーする慎重な運用方針

## 3. 対応トレードスタイル（スキャル / デイ）
- スキャル: 1〜5 分足で期間 7 または 14 を使用。ノイズ許容は低く、閾値からの乖離許容幅を小さく設定
- デイ: 15〜60 分足で期間 14 または 21 を使用。主要セッションの流れを優先し、日内で完結させる前提

## 4. 生データとして記録する項目（Layer1）
- 時系列終値（必須）、時間足（例: 1m/5m/15m/60m）、期間 N（初期値 14）
- 価格取得元: 市場データ API（終値精度は少なくとも小数第 2 位まで保持）
- 欠損補填: 終値欠損時はその足を無視し、連続欠損 2 本以上で算出停止とする
- タイムゾーン: UTC で保存し、表示時にユーザータイムゾーンへ変換

## 5. 判断コンテキスト（Layer2）
- 現在の RSI 値（0〜100 の実数）
- 平均上昇幅と平均下落幅（期間 N での平滑化済み）
- 傾き（RSI[t] − RSI[t-1]）、および直近 3 本の合計傾き
- 基準上限・下限への距離: distUpper = RSI − upper、distLower = lower − RSI
- クロスイベント: 上抜け/下抜けの発生タイミング、経過本数
- 基準比率: ratioUpper = (RSI - upper) / tol_near、ratioLower = (lower - RSI) / tol_near
- **正規化相対位置**: normalizedPosition = (RSI - lower) / (upper - lower)（0〜1 スケール。将来的に閾値変更時の比較を可能にする）
- **基準からの乖離**: ユーザー基準（upper/lower）からの絶対距離と比率を保持し、「当時どれだけ極端だったか」を後から評価可能にする


## 6. 言語化レイヤー（Layer3）
- 「買われすぎ圏に接近」= distUpper が 0 < distUpper ≤ tol_near（初期値 2）
- 「買われすぎを超過」= RSI が upper を現在足で初めて満たし、前足は未満
- 「売られすぎ圏に接近」= distLower が 0 < distLower ≤ tol_near
- 「売られすぎを超過」= RSI が lower を現在足で初めて下回り、前足は以上
- 「反転気配」= 上限超過後に傾きが負へ反転し、RSI が upper−1 以下まで戻る、または下限超過後に傾きが正へ反転し、lower+1 以上まで戻る（いずれも 2 本以内）
- 「レンジ中立」= lower+tol_near < RSI < upper−tol_near かつ絶対傾き < 1

## 7. ユーザー基準値の扱い
- 基準上限/下限の既定値: upper=70, lower=30。代替推奨: 65/35（やや緩い設定）
- 近接許容幅 tol_near（初期値 2）と反転確認幅 1pt はユーザーが設定可
- 期間 N（7/14/21 の整数）を許容。整数以外や 2 未満、100 超はバリデーションで拒否
- 設定変更時は Layer2 の距離・傾き判定と Layer3 の語彙マッピングに即時反映する

## 8. マッチングに使用する特徴量
- 現在 RSI 値、傾き、直近クロス種別（上抜け/下抜け）、経過本数
- 閾値距離（distUpper/distLower）、近接判定（tol_near 以内か）、反転判定フラグ
- 期間 N と使用時間足。スタイル別に期待される期間と時間足の整合をチェック
- 例: 「RSI が upper を 2pt 超過し、直近 2 本連続で傾きが負」→ 逆張りショートの一致理由として採用
- **他インジケーターとの矛盾検出**: トレンド系（MA 等）が上昇継続を示す中で RSI 売られすぎシグナルが出た場合、「過熱系 RSI と位置系 MA に矛盾あり。エントリー見送り推奨」といった注意喚起を生成
- **役割**: モメンタム系（過熱判定）。単独での確定判断は行わず、トレンド系との整合を必須とする

## 9. AI が利用してよい情報 / 禁止情報
- 利用可: Layer2/Layer3 の特徴量、ユーザーが設定した閾値・期間、時間足、マッチ理由のテキスト
- 禁止: 個別の生ローソク足データ、取引数量、個別銘柄名や未公開注文履歴などの個人情報
- AI 入力前に銘柄名・約定ID は匿名化し、数値特徴のみを渡す

## 10. 将来拡張時の注意点
- 平滑化手法を変更（Wilder→EMA 等）する場合は基準値の互換性を検証し、過去ノートとの齟齬を明示する
- 他インジケーター（MA/BB 等）と組み合わせる際は、閾値条件の優先順位と衝突時の解決ルールを定義する
- バージョンタグを付与し、旧版とのマッチ結果差分を記録。通知ロジックへ影響が出る場合は必ずリリースノートを更新する
## 11. 本インジケーターが不適切な状況
- **強トレンド継続局面**: MA（移動平均線）が明確に上昇/下降を継続している場合、RSI の逆張りシグナルは機能しにくい。トレンド系との矛盾を検出し、エントリー見送りを推奨する
- **経済指標発表前後**: 非連続な価格変動が想定されるため、過去の RSI パターンが通用しない可能性が高い
- **極端な出来高低下時**: スプレッド拡大や流動性不足により、RSI 値が実際の需給を反映しない場合がある
- **ユーザー設定の極端な偏り**: 閾値が 90/10 など非現実的な値に設定されている場合、シグナル頻度が極端に減少し実用性を失う
- **初期データ不足**: 期間 N 未満のデータしかない場合、計算結果の信頼性が低いため、マッチング判定を保留する

## 12. 類似度設定（StrategyNoteマッチング用）

### 比較方式
- **タイプ**: `absolute`（絶対値乖離）
- **理由**: RSIは0〜100の固定範囲であり、絶対値での比較が直感的かつ有効

### 設定パラメータ
| パラメータ | 値 | 説明 |
|-----------|-----|------|
| type | absolute | 絶対値比較 |
| tolerance | 5 | 許容乖離（±5pt以内を類似とみなす） |
| weight | 1.0 | 総合スコアでの重み |
| considerDirection | true | 傾き方向も考慮するか |

### スコア計算式
```
乖離 = |RSI_saved - RSI_current|
score = max(0, 1 - (乖離 / tolerance))

例: 保存時 RSI=30, 現在 RSI=33
乖離 = 3, score = 1 - (3/5) = 0.4 → 40%一致
```

### 方向性ボーナス（considerDirection=true時）
- 保存時と現在の傾き方向が一致: +10%ボーナス
- 方向が逆: -20%ペナルティ